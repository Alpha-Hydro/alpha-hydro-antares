(function(){(function($){$.fn.editTable=function(options){var $table,Draw,Edit,Mode,defaults,settings;$table=this;defaults={inputFormClass:"form-control input-sm",groupBtnClass:"btn-group btn-group-sm",inputClass:"edittable-input",eventType:"click",rowIdentifier:"id",editButton:true,deleteButton:true,saveButton:true,removeButton:true,buttons:{edit:{"class":"btn btn-sm btn-default",html:'<span class="glyphicon glyphicon-pencil"></span>',action:"edit"},"delete":{"class":"btn btn-sm btn-default",html:'<span class="glyphicon glyphicon-trash"></span>',action:"delete"},save:{"class":"btn btn-sm btn-success",html:"Сохранить",action:"save"},remove:{"class":"btn btn-sm btn-danger",html:'<span class="glyphicon glyphicon-remove"></span>',action:"remove"}},onDraw:function(){}};settings=$.extend(true,defaults,options);Draw={columns:{edittabledata:function(){var $td;$td=$table.find("td[data-mode]");return $td.each(function(){var i,input,span;i=$(this).index()-1;span="<span>"+$(this).text()+"</span>";input="<input class='form-control input-sm hidden "+settings.inputClass+"' type='text' name='"+settings.columns.editable[i][1]+"' value='"+$(this).text()+"' disabled/>";return $(this).html(span+input)})},toolbar:function(){var $tr,deleteButton,editButton,headTable,removeButton,saveButton,toolbar;editButton='<button type="button" class="edittable-edit-button '+settings.buttons.edit["class"]+'">'+settings.buttons.edit.html+"</button>";deleteButton='<button type="button" class="edittable-delete-button '+settings.buttons["delete"]["class"]+'">'+settings.buttons["delete"].html+"</button>";saveButton='<button type="button" class="edittable-save-button '+settings.buttons.save["class"]+' hidden">'+settings.buttons.save.html+"</button>";removeButton='<button type="button" class="edittable-remove-button '+settings.buttons.remove["class"]+' hidden">'+settings.buttons.remove.html+"</button>";toolbar=saveButton+removeButton+"<div class='ml1 "+settings.groupBtnClass+"'>"+(editButton+deleteButton)+"</div>";headTable=$table.find("th");if(headTable.length!==0){$table.find("tr:first").append("<th></th>")}$tr=$table.find("tbody tr");return $tr.each(function(){return $(this).append("<td class='text-right'>"+toolbar+"</td>")})}}};Mode={view:function(td){var $input,$tr;$tr=$(td).parent("tr");$input=$(td).find("input."+settings.inputClass);$input.blur().addClass("hidden").prop("disabled",true);$(td).find("span").show();$(td).attr("data-mode","view");if(settings.editButton){$tr.find("button.edittable-save-button").addClass("hidden");return $tr.find("button.edittable-edit-button").removeClass("active").blur()}},edit:function(td){var $input,$tr;$tr=$(td).parent("tr");$(td).find("span").hide();$input=$(td).find("input."+settings.inputClass);$input.prop("disabled",false).removeClass("hidden").focus();$(td).attr("data-mode","edit");if(settings.editButton){$tr.find("button.edittable-edit-button").addClass("active");return $tr.find("button.edittable-save-button").removeClass("hidden")}}};Edit={reset:function(td){return $(td).each(function(){var $input,text;$input=$(this).find("input."+settings.inputClass);text=$(this).find("span").text();$input.val(text);return Mode.view(this)})},submit:function(td){var serialize;serialize=$table.find("input."+settings.inputClass).serializeArray();console.log(serialize);return $(td).each(function(){var $input;$input=$(this).find("input."+settings.inputClass);return Mode.view(this)})}};Draw.columns.edittabledata();Draw.columns.toolbar();settings.onDraw();if(settings.editButton){$table.on("click","button.edittable-edit-button",function(event){var $button,activated;if(event.handled!==true){event.preventDefault();$button=$(this);activated=$button.hasClass("active");Edit.reset($table.find('td[data-mode = "edit"]'));if(!activated){$($button.parents("tr").find("td[data-mode]").get().reverse()).each(function(){return Mode.edit(this)})}return event.handled=true}});$table.on("click","button.edittable-save-button",function(event){if(event.handled!==true){event.preventDefault();Edit.submit($(this).parents("tr").find('td[data-mode = "edit"]'));return event.handled=true}})}return this};return false})(jQuery)}).call(this);