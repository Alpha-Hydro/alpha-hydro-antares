// Generated by CoffeeScript 1.9.3
(function() {
  (function($) {
    var ajaxResponseContent, dropdoun, googleResponseContent, googleSearch, query, searchResult, urlParam;
    ajaxResponseContent = $('#search-autocomplete');
    googleResponseContent = $('#google-search');
    dropdoun = $('.dropdown');
    $(document).on('keyup', '#search-query', function(e) {
      var value;
      value = $(this).val();
      console.log(e.keyCode);
      return $.ajax({
        url: '/search/index/autocomplete/',
        type: 'post',
        dataType: 'html',
        data: {
          query: value
        },
        error: function(jqXHR, textStatus, errorThrown) {
          return ajaxResponseContent.html("AJAX Error: " + textStatus);
        },
        success: function(data, textStatus, jqXHR) {
          ajaxResponseContent.html(data);
          if (data !== '') {
            return dropdoun.addClass('open');
          } else {
            return dropdoun.removeClass('open');
          }
        }
      });
    });
    urlParam = function(name) {
      var result;
      result = new RegExp('[\?&]' + name + '=([^&#]*)').exec(document.location.search);
      return result[1] || 0;
    };
    googleSearch = function(q) {
      return $.ajax({
        url: 'https://www.googleapis.com/customsearch/v1',
        type: 'get',
        dataType: 'json',
        data: {
          key: 'AIzaSyA4c9AkQoBRpYIgHNJSUqLs0MGb4v6c6Fc',
          cx: '002321161471768174809:g2hp7ihrj1u',
          q: q
        },
        error: function(jqXHR, textStatus, errorThrown) {
          return console.log("AJAX Error: " + textStatus);
        },
        success: function(data, textStatus, jqXHR) {
          return searchResult(data);
        }
      });
    };
    searchResult = function(data) {
      var html, i, item, items, len, link, results, snippet, title;
      items = data.items;
      results = [];
      for (i = 0, len = items.length; i < len; i++) {
        item = items[i];
        link = item.link;
        title = item.title;
        snippet = item.snippet;
        html = '<div>' + title + '</div>';
        html += '<div>' + snippet + '</div>';
        html += '<div>' + link + '</div>';
        results.push(googleResponseContent.append(html));
      }
      return results;
    };
    query = urlParam('query');
    console.log(decodeURIComponent(query));
    if (query != null) {
      return googleSearch(decodeURIComponent(query));
    }
  })(jQuery);

}).call(this);

//# sourceMappingURL=search.js.map
